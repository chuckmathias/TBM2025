{% extends "base.html" %}
{% load wagtailcore_tags %}
{% load static %}

{% block content %}
<div class="grid-container">
    {% if missionary %}
        <div class="missionary-profile-summary text-center" style="margin-bottom:2rem;">
            <h2>Updates for {{ missionary.name }}</h2>
            {% if missionary.profile_header_image %}
                <img src="{{ missionary.profile_header_image.file.url }}" alt="{{ missionary.name }}" style="max-width:200px;">
            {% endif %}
            <p><strong>Project:</strong> {{ missionary.project }}</p>
            <p><strong>Region:</strong> {{ missionary.region }}</p>
            <p>{{ missionary.project_summary }}</p>
            <a href="{{ missionary.url }}" class="button">View Missionary Profile</a>
        </div>
    {% else %}
        <h2 class="text-center">All Missionary Updates</h2>
    {% endif %}
    <form method="get" class="text-center" style="margin-bottom: 2rem;">
        <label for="missionary-select"><strong>Filter by Missionary:</strong></label>
        <select id="missionary-select" name="project" onchange="this.form.submit()">
            <option value="">All Missionaries</option>
            {% for m in missionaries %}
                <option value="{{ m.slug }}"{% if missionary and m.slug == missionary.slug %} selected{% endif %}>{{ m.name }}</option>
            {% endfor %}
        </select>
        <noscript><button type="submit">Filter</button></noscript>
    </form>
    <div class="grid-x grid-margin-x align-center">
        {% for update in updates %}
            <div class="cell small-12 medium-4">
                <a href="{{ update.url }}" class="card-link">
                    <div class="update-card">
                        <div class="card-image">
                            {% if update.header_image %}
                                <img src="{{ update.header_image.file.url }}" alt="Missionary Update">
                            {% else %}
                                <img src="{% static 'images/default_update.jpg' %}" alt="Default Update Image">
                            {% endif %}
                        </div>
                        <div class="card-content">
                            <h3>{{ update.title }}</h3>
                            <p class="date">{{ update.date }}</p>
                            <div class="summary">{{ update.summary|richtext }}</div>
                            {% if update.missionary_profile %}
                                <p class="missionary-name"><strong>Missionary:</strong> {{ update.missionary_profile.name }}</p>
                            {% endif %}
                        </div>
                    </div>
                </a>
            </div>
        {% empty %}
            <p class="text-center">No updates available.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}